// === GLOBAL VARIABLES ===
let isLoggedIn = false;
const loginBox = document.querySelector('.login-box');
const menuSection = document.querySelector('.menu-section');
const videosSection = document.querySelectorAll('.video-section');
const reelsSection = document.querySelector('.reels-section');
const logoutBtn = document.querySelector('.logout');
const darkToggle = document.querySelector('#darkToggle');

// === LOGIN SYSTEM ===
function login(username, password) {
    if(username === "user" && password === "1234") {
        isLoggedIn = true;
        loginBox.style.display = 'none';
        menuSection.style.display = 'block';
        videosSection.forEach(v => v.style.display = 'block');
        reelsSection.style.display = 'block';
        localStorage.setItem('loggedIn', true);
    } else {
        document.querySelector('#error').innerText = "Invalid username or password!";
    }
}

document.querySelector('#loginBtn').addEventListener('click', () => {
    const username = document.querySelector('#username').value;
    const password = document.querySelector('#password').value;
    login(username, password);
});

// === LOGOUT SYSTEM ===
logoutBtn.addEventListener('click', () => {
    isLoggedIn = false;
    loginBox.style.display = 'block';
    menuSection.style.display = 'none';
    videosSection.forEach(v => v.style.display = 'none');
    reelsSection.style.display = 'none';
    localStorage.removeItem('loggedIn');
});

// === DARK/LIGHT MODE ===
darkToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
});

// === CANVAS EYE & AMOEBA BACKGROUND ===
const canvas = document.createElement('canvas');
canvas.id = "backgroundCanvas";
canvas.style.position = "fixed";
canvas.style.top = "0";
canvas.style.left = "0";
canvas.style.width = "100%";
canvas.style.height = "100%";
canvas.style.zIndex = "-2";
document.body.appendChild(canvas);

const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
});

// Particle system
class Particle {
    constructor(shape){
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        this.vx = (Math.random()-0.5)*1.5;
        this.vy = (Math.random()-0.5)*1.5;
        this.size = Math.random()*30 + 20;
        this.shape = shape; // "eye" or "amoeba"
        this.angle = Math.random() * Math.PI * 2;
        this.speed = Math.random()*0.02 + 0.01;
    }

    update(){
        this.x += this.vx;
        this.y += this.vy;
        this.angle += this.speed;

        if(this.x<0 || this.x>width) this.vx*=-1;
        if(this.y<0 || this.y>height) this.vy*=-1;
    }

    draw(ctx){
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        ctx.shadowColor = "#0ff";
        ctx.shadowBlur = 20;

        if(this.shape === "eye"){
            // Draw simple Eye
            ctx.beginPath();
            ctx.fillStyle = "rgba(0,255,255,0.6)";
            ctx.ellipse(0,0,this.size,this.size*0.6,0,0,Math.PI*2);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.arc(0,0,this.size*0.3,0,Math.PI*2);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "#0ff";
            ctx.arc(0,0,this.size*0.15,0,Math.PI*2);
            ctx.fill();
        } else if(this.shape === "amoeba"){
            // Draw Amoeba-like blob
            ctx.beginPath();
            ctx.fillStyle = "rgba(255,0,255,0.5)";
            let r = this.size;
            ctx.moveTo(r*Math.cos(0), r*Math.sin(0));
            for(let i=0; i<=Math.PI*2; i+=Math.PI/5){
                let radius = r + Math.sin(i*3 + this.angle*5)*r*0.3;
                ctx.lineTo(radius*Math.cos(i), radius*Math.sin(i));
            }
            ctx.closePath();
            ctx.fill();
        }

        ctx.restore();
    }
}

let particles = [];
for(let i=0;i<15;i++){
    particles.push(new Particle("eye"));
}
for(let i=0;i<12;i++){
    particles.push(new Particle("amoeba"));
}

function animate(){
    ctx.clearRect(0,0,width,height);
    particles.forEach(p => {
        p.update();
        p.draw(ctx);
    });
    requestAnimationFrame(animate);
}
animate();
